<firebot-tabs class="kick-tabs" ng-init="activeTab = 'connections'" active="activeTab" type="underlined" page-tabs="true">
    <firebot-tab name="connections" label="Connections">
        <div class="kick-connections-container">
            <!-- Streamer Connection Section -->
            <div class="connection-section">
                <div class="connection-header">
                    <div class="connection-title">Streamer Connection</div>
                    <div class="status-badge" ng-class="getStreamerStatusClass()">
                        {{ getStreamerStatusText() }}
                    </div>
                </div>

                <div class="status-message alert alert-info">
                    {{ connections.streamer.status }}
                </div>

                <div class="missing-scope-block" ng-if="connections.streamer.missingScopes.length">
                    <div class="missing-title">Missing Kick permissions</div>
                    <p class="missing-copy">Update your Kick app scopes and authorize again so chat tools and channel controls work correctly.</p>
                    <ul>
                        <li ng-repeat="scope in connections.streamer.missingScopes track by scope"><code>{{ scope }}</code></li>
                    </ul>
                </div>

                <div class="button-group">
                    <button class="btn btn-authorize" ng-click="authorizeStreamer()" ng-disabled="connections.streamer.tokenExpiresAt && !connections.streamer.missingScopes.length">
                        Authorize Streamer
                    </button>
                    <button class="btn btn-deauthorize" ng-click="deauthorizeStreamer()" ng-disabled="!connections.streamer.tokenExpiresAt">
                        Deauthorize
                    </button>
                </div>
            </div>

            <!-- Bot Connection Section -->
            <div class="connection-section">
                <div class="connection-header">
                    <div class="connection-title">Bot Connection</div>
                    <div class="status-badge" ng-class="getBotStatusClass()">
                        {{ getBotStatusText() }}
                    </div>
                </div>

                <div class="status-message alert alert-info">
                    {{ connections.bot.status }}
                </div>

                <div class="missing-scope-block" ng-if="connections.bot.missingScopes.length">
                    <div class="missing-title">Missing Kick permissions</div>
                    <p class="missing-copy">Turn on these permissions for the bot account, then authorize again.</p>
                    <ul>
                        <li ng-repeat="scope in connections.bot.missingScopes track by scope"><code>{{ scope }}</code></li>
                    </ul>
                </div>

                <div class="button-group">
                    <button class="btn btn-authorize" ng-click="authorizeBot()" ng-disabled="connections.bot.tokenExpiresAt && !connections.bot.missingScopes.length">
                        Authorize Bot
                    </button>
                    <button class="btn btn-deauthorize" ng-click="deauthorizeBot()" ng-disabled="!connections.bot.tokenExpiresAt">
                        Deauthorize
                    </button>
                </div>
            </div>

            <!-- Webhook Section - URL exists -->
            <div class="connection-section" ng-if="webhookUrl">
                <div class="connection-header">
                    <div class="connection-title">Webhook Configuration</div>
                </div>

                <div class="webhook-tip-message alert alert-info">
                    This needs to be entered as the webhook URL when you create your Kick app.
                </div>

                <div class="webhook-url-container">
                    <div class="webhook-url">{{ webhookUrl }}</div>
                    <button id="btn-copy-webhook-url" class="btn btn-primary btn-copy" ng-click="copyWebhookUrl()">Copy URL</button>
                </div>
            </div>

            <!-- Webhook Section - URL not registered -->
            <div class="connection-section" ng-if="!webhookUrl">
                <div class="connection-header">
                    <div class="connection-title">Webhook Configuration</div>
                </div>

                <div class="webhook-tip-message alert alert-warning">
                    Webhook not registered yet. Click the button below to register.
                </div>

                <button class="btn btn-primary" ng-click="registerWebhook()">
                    Register Webhook
                </button>
            </div>

            <!-- Maintenance Section -->
            <div class="connection-section" ng-if="connections.streamer.ready && connections.connected">
                <div class="connection-header">
                    <div class="connection-title">Maintenance</div>
                </div>

                <div class="maintenance-button-container">
                    <button class="btn btn-warning" ng-click="resetWebhookSubscriptions()" title="Use this button only if the webhook URL was changed or webhooks are not working correctly. This may cause instability.">
                        Reset Webhook Subscriptions
                    </button>
                </div>
            </div>
        </div>
    </firebot-tab>

    <firebot-tab name="rewards" label="Channel Rewards">
        <div class="kick-rewards-tab">
            <firebot-item-table
                items="rewardsTab.firebotRewards"
                headers="rewardHeaders"
                context-menu-options="rewardMenuOptions(item)"
                no-data-message="No channel rewards found. Create a reward in Firebot's Channel Rewards section."
                none-found-message="No channel rewards found."
                search-placeholder="Search rewards"
            >
            </firebot-item-table>
        </div>

        <div class="kick-rewards-footer-fixed" ng-if="activeTab === 'rewards' && !rewardsTab.loading">
            <div style="flex-shrink: 0; display: flex; align-items: center">
                <span>Total Kick Rewards
                    <tooltip text="'Kick limits channels to 15 total channel rewards. This includes both managed and external rewards.'" />
                </span>
                <span class="my-0 mx-4" style="font-size: 20px;">
                    {{rewardsTab.totalKickRewardsCount}} / 15
                </span>
            </div>
            <div style="width: 100%">
                <div style="
                    width: 100%;
                    background: #24262a;
                    height: 8px;
                    border-radius: 8px;
                    overflow: hidden;
                ">
                    <div style="height: 100%; background: #53fc18"
                        ng-style="{ width: ((rewardsTab.totalKickRewardsCount / 15) * 100) + '%' }"></div>
                </div>
            </div>
            <button class="btn btn-primary" ng-click="loadRewards()" style="flex-shrink: 0;">
                <i class="fas fa-sync" style="margin-right: 5px;"></i> Refresh
            </button>
            <button class="btn btn-primary" ng-click="syncAllRewards()" style="flex-shrink: 0; margin-right: 10px;" ng-disabled="rewardsTab.syncedCount === 0">
                <i class="fas fa-sync-alt" style="margin-right: 5px;"></i> Sync All
            </button>
        </div>
    </firebot-tab>
</firebot-tabs>

<script type="text/ng-template" id="kickErrorModal.html">
    <div class="modal-header">
        <button type="button" class="close" ng-click="close()"><span>&times;</span></button>
        <h4 class="modal-title" style="color: #dc3545;">{{title}}</h4>
    </div>
    <div class="modal-body">
        <p><strong>{{message}}</strong></p>
        <p ng-if="details" style="font-family: monospace; font-size: 12px; opacity: 0.8; word-break: break-word;">{{details}}</p>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-danger" ng-click="close()">OK</button>
    </div>
</script>

<script type="text/ng-template" id="kickAuthModal.html">
    <div class="modal-header">
        <button type="button" class="close" ng-click="close()"><span>&times;</span></button>
        <h4 class="modal-title">{{modalTitle}}</h4>
    </div>
    <div class="modal-body">
        <p><strong>To authorize your connection:</strong></p>
        <ol>
            <li>Sign in to the <span ng-show="currentAuthType === 'streamer'">streamer</span><span ng-show="currentAuthType === 'bot'">bot</span> account on kick.com in your browser</li>
            <li>Click the "Copy Link" button below</li>
            <li>Paste the link into your browser</li>
            <li>Complete the authorization on Kick</li>
            <li>This modal will close automatically when authorization is complete</li>
        </ol>
        <div ng-show="currentAuthType === 'bot'" style="margin-top: 15px; padding: 10px; border-radius: 4px; background-color: #d1ecf1; color: #0c5460; font-size: 13px;">
            <strong>Note:</strong> We recommend completing this authorization in an incognito window to avoid conflicts with your streamer account.
        </div>
        <div style="display: flex; gap: 10px; margin: 20px 0; align-items: center;">
            <div style="flex: 1; padding: 12px; border-radius: 6px; border: 1px solid #47494e; background: #24262a; color: #e6f1ff; word-break: break-all; font-family: monospace; font-size: 12px; max-height: 100px; overflow-y: auto;">
                {{authUrl}}
            </div>
            <button id="btn-copy-url-modal" type="button" class="btn btn-primary" ng-click="copyUrl()">Copy Link</button>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-default" ng-click="close()">Close</button>
    </div>
</script>

<script type="text/ng-template" id="editKickRewardPropertiesModal.html">
    <div class="modal-header">
        <button type="button" class="close" ng-click="dismiss()"><span>&times;</span></button>
        <h4 class="modal-title">Edit Kick Properties: {{reward.title}}</h4>
    </div>
    <div class="modal-body">
        <div class="form-group">
            <label for="kick-cost-modal" class="control-label">Kick Cost</label>
            <input
                type="number"
                id="kick-cost-modal"
                class="form-control"
                ng-model="cost"
                min="0"
                placeholder="Enter cost"
            />
            <p class="help-block">The cost in Kick channel points</p>
        </div>

        <div class="form-group">
            <label class="control-label">
                <input type="checkbox" ng-model="skipQueue" />
                Skip Queue
            </label>
            <p class="help-block">If enabled, redemptions will be auto-approved without manual review</p>
        </div>

        <div class="form-group">
            <label class="control-label">
                <input type="checkbox" ng-model="enabled" />
                Enabled
            </label>
            <p class="help-block">If disabled, viewers cannot redeem this reward</p>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-default" ng-click="dismiss()">Cancel</button>
        <button type="button" class="btn btn-primary" ng-click="save()">Save</button>
    </div>
</script>

<script type="text/ng-template" id="kickConfirmModal.html">
    <div class="modal-header">
        <button type="button" class="close" ng-click="cancel()"><span>&times;</span></button>
        <h4 class="modal-title">{{title}}</h4>
    </div>
    <div class="modal-body">
        <p>{{message}}</p>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-default" ng-click="cancel()">Cancel</button>
        <button type="button" class="btn btn-primary" ng-click="confirm()">Confirm</button>
    </div>
</script>

<script type="text/ng-template" id="kickInfoModal.html">
    <div class="modal-header">
        <button type="button" class="close" ng-click="close()"><span>&times;</span></button>
        <h4 class="modal-title">{{title}}</h4>
    </div>
    <div class="modal-body">
        <p>{{message}}</p>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-primary" ng-click="close()">OK</button>
    </div>
</script>
